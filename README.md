# Zoaholic

<p align="center">
  <img src="static/zoaholic.png" alt="Zoaholic Logo" width="200"/>
</p>

<p align="center">
  <strong>ç»Ÿä¸€å¤§æ¨¡å‹ API ç½‘å…³</strong>
</p>

<p align="center">
  <a href="./README.md">ä¸­æ–‡</a> | <a href="./README_EN.md">English</a>
</p>

## ğŸ“– ä»‹ç»

Zoaholic æ˜¯ä¸€ä¸ªåŸºäº [uni-api](https://github.com/yym68686/uni-api) äºŒæ¬¡å¼€å‘çš„ç»Ÿä¸€å¤§æ¨¡å‹ API ç½‘å…³ã€‚é¢å‘é«˜å®¢åˆ¶åŒ–çš„å¤æ‚éœ€æ±‚ï¼Œå»é™¤ new-api å¤æ‚çš„å•†ä¸šåŠŸèƒ½ã€‚å®ƒé€šè¿‡ä¸€ä¸ªç»Ÿä¸€çš„ API æ¥å£è°ƒç”¨å¤šç§ä¸åŒæä¾›å•†çš„æœåŠ¡ï¼Œç»Ÿä¸€è½¬æ¢ä¸º OpenAI æ ¼å¼ï¼Œæ”¯æŒè´Ÿè½½å‡è¡¡ã€‚

### æ”¯æŒçš„åç«¯æœåŠ¡

| æä¾›å•† | æ”¯æŒçŠ¶æ€ | è¯´æ˜ |
|--------|----------|------|
| OpenAI | âœ… | åŒ…æ‹¬ GPT-4oã€DALL-E 3 ç­‰ |
| Anthropic | âœ… | Claude ç³»åˆ—æ¨¡å‹ |
| Google Gemini | âœ… | Gemini 2.5 Pro/Flash ç­‰ |
| Google Vertex AI | âœ… | åŒæ—¶æ”¯æŒ Claude å’Œ Gemini |
| Azure OpenAI | âœ… | Azure æ‰˜ç®¡çš„ OpenAI æ¨¡å‹ |
| AWS Bedrock | âœ… | Claude ç­‰æ¨¡å‹ |
| è‡ªå®šä¹‰æ’ä»¶ | âœ… | é€šè¿‡æ’ä»¶ç³»ç»Ÿæ‰©å±• |

## âœ¨ ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½

- **çº¯é…ç½®æ–‡ä»¶é©±åŠ¨** - åªéœ€ç¼–å†™ä¸€ä¸ª `api.yaml` æ–‡ä»¶å³å¯è¿è¡Œï¼Œå°ç™½å‹å¥½
- **ç»Ÿä¸€ API æ ¼å¼** - æ‰€æœ‰åç«¯æœåŠ¡ç»Ÿä¸€è½¬æ¢ä¸º OpenAI æ ¼å¼
- **å†…ç½®ç®¡ç†å‰ç«¯** - Material Design 3 é£æ ¼çš„å¯è§†åŒ–ç®¡ç†ç•Œé¢
- **æ’ä»¶ç³»ç»Ÿ** - æ”¯æŒé€šè¿‡æ’ä»¶æ‰©å±•æ¸ é“ã€ä¸­é—´ä»¶ã€é’©å­ç­‰

### è´Ÿè½½å‡è¡¡

- **æ¸ é“çº§åŠ æƒè´Ÿè½½å‡è¡¡** - æ ¹æ®ä¸åŒæ¸ é“æƒé‡åˆ†é…è¯·æ±‚
- **Vertex åŒºåŸŸçº§è´Ÿè½½å‡è¡¡** - æœ€é«˜å¯å°†å¹¶å‘æé«˜ (APIæ•°é‡ Ã— åŒºåŸŸæ•°é‡) å€
- **æ¸ é“çº§é¡ºåºè´Ÿè½½å‡è¡¡** - æé«˜æ²‰æµ¸å¼ç¿»è¯‘ä½“éªŒ
- **API Key çº§åˆ«è½®è¯¢** - å•æ¸ é“å¤š Key è‡ªåŠ¨è´Ÿè½½å‡è¡¡

### é«˜å¯ç”¨

- **è‡ªåŠ¨é‡è¯•** - API æ¸ é“å“åº”å¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•ä¸‹ä¸€ä¸ªæ¸ é“
- **æ¸ é“å†·å´** - å¤±è´¥æ¸ é“è‡ªåŠ¨æ’é™¤ï¼Œå†·å´åè‡ªåŠ¨æ¢å¤
- **ç»†ç²’åº¦è¶…æ—¶** - å¯ä¸ºæ¯ä¸ªæ¨¡å‹è®¾ç½®ä¸åŒçš„è¶…æ—¶æ—¶é—´

### å®‰å…¨ä¸æ§åˆ¶

- **ç»†ç²’åº¦æƒé™æ§åˆ¶** - æ”¯æŒé€šé…ç¬¦è®¾ç½® API Key å¯ç”¨æ¨¡å‹
- **é™æµ** - æ”¯æŒå¤šç§é¢‘ç‡é™åˆ¶ï¼ˆåˆ†é’Ÿ/å°æ—¶/å¤©/æœˆ/å¹´ï¼‰
- **é“å¾·å®¡æŸ¥** - æ”¯æŒ OpenAI moderation å®¡æŸ¥ï¼Œé™ä½å°ç¦é£é™©

### API ç«¯ç‚¹

- `/v1/chat/completions` - èŠå¤©è¡¥å…¨ï¼ˆOpenAI å…¼å®¹ï¼‰
- `/v1/images/generations` - å›¾åƒç”Ÿæˆ
- `/v1/audio/transcriptions` - éŸ³é¢‘è½¬å½•
- `/v1/embeddings` - æ–‡æœ¬åµŒå…¥
- `/v1/moderations` - å†…å®¹å®¡æ ¸
- `/v1/models` - æ¨¡å‹åˆ—è¡¨
- `/v1beta/models` - Gemini åŸç”Ÿæ ¼å¼æ¨¡å‹åˆ—è¡¨
- `/v1beta/models/{model}:generateContent` - Gemini åŸç”Ÿæ ¼å¼ï¼ˆéæµå¼ï¼‰
- `/v1beta/models/{model}:streamGenerateContent` - Gemini åŸç”Ÿæ ¼å¼ï¼ˆæµå¼ï¼‰
- `/v1/messages` - Claude åŸç”Ÿæ ¼å¼

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Python 3.11+
- æˆ– Docker

### æ–¹æ³•ä¸€ï¼šDocker éƒ¨ç½²ï¼ˆæ¨èï¼‰

1. åˆ›å»ºé…ç½®æ–‡ä»¶ `api.yaml`ï¼š

```yaml
providers:
  - provider: openai
    base_url: https://api.openai.com/v1/chat/completions
    api: sk-your-api-key

api_keys:
  - api: sk-your-zoaholic-key
```

2. ä½¿ç”¨ Docker Compose å¯åŠ¨ï¼š

```yaml
# docker-compose.yml
services:
  zoaholic:
    container_name: zoaholic
    image: zoaholic:latest
    ports:
      - 8000:8000
    volumes:
      - ./api.yaml:/home/api.yaml
      - ./data:/home/data
```

```bash
docker-compose up -d
```

### æ–¹æ³•äºŒï¼šæœ¬åœ°è¿è¡Œ

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/your-repo/zoaholic.git
cd zoaholic

# å®‰è£…ä¾èµ–ï¼ˆæ¨èä½¿ç”¨ uvï¼‰
uv sync

# åˆ›å»ºé…ç½®æ–‡ä»¶
cp api.yaml.example api.yaml
# ç¼–è¾‘ api.yaml é…ç½®ä½ çš„ API

# å¯åŠ¨æœåŠ¡
python main.py

# å¼€å‘æ¨¡å¼ï¼ˆå¯ç”¨çƒ­é‡è½½ï¼‰
RELOAD=true python main.py
# æˆ–ä½¿ç”¨ uvicorn å‘½ä»¤
python -m uvicorn main:app --host 0.0.0.0 --port 8000 --reload
```

### æ–¹æ³•ä¸‰ï¼šä½¿ç”¨ CONFIG_URL

é€šè¿‡ç¯å¢ƒå˜é‡æŒ‡å®šè¿œç¨‹é…ç½®æ–‡ä»¶ï¼š

```bash
export CONFIG_URL=https://your-server.com/api.yaml
python main.py
```

## ğŸ“ é…ç½®æŒ‡å—

### æœ€å°é…ç½®

```yaml
providers:
  - provider: openai
    base_url: https://api.openai.com/v1/chat/completions
    api: sk-your-api-key

api_keys:
  - api: sk-your-zoaholic-key
```

### å®Œæ•´é…ç½®ç¤ºä¾‹

```yaml
providers:
  # OpenAI æ ¼å¼æä¾›å•†
  - provider: openai
    base_url: https://api.openai.com/v1/chat/completions
    api: sk-xxx
    model:
      - gpt-4o
      - gpt-4o-mini
      - dall-e-3

  # Anthropic Claude
  - provider: anthropic
    base_url: https://api.anthropic.com/v1/messages
    api:
      - sk-ant-api03-xxx  # æ”¯æŒå¤š Key è½®è¯¢
      - sk-ant-api03-yyy
    model:
      - claude-3-5-sonnet-20240620: claude-3-5-sonnet  # é‡å‘½åæ¨¡å‹
      - claude-3-7-sonnet-20250219: claude-3-7-sonnet-think
    tools: true
    preferences:
      api_key_rate_limit: 15/min
      api_key_cooldown_period: 60

  # Google Gemini
  - provider: gemini
    base_url: https://generativelanguage.googleapis.com/v1beta
    api:
      - AIzaSyxxx
      - AIzaSyyyy
    model:
      - gemini-2.5-pro
      - gemini-2.5-flash
      - gemini-2.5-pro: gemini-2.5-pro-search  # æœç´¢ç‰ˆæœ¬
    tools: true
    preferences:
      api_key_rate_limit: 15/min
      model_timeout:
        gemini-2.5-pro: 500
        default: 100
      post_body_parameter_overrides:
        gemini-2.5-pro-search:
          tools:
            - google_search: {}

  # Google Vertex AI
  - provider: vertex
    project_id: your-project-id
    private_key: "-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----"
    client_email: xxx@xxx.iam.gserviceaccount.com
    model:
      - gemini-2.5-flash
      - claude-3-5-sonnet@20240620: claude-3-5-sonnet
    tools: true

  # Azure OpenAI
  - provider: azure
    base_url: https://your-endpoint.openai.azure.com
    api: your-api-key
    model:
      - gpt-4o

  # AWS Bedrock
  - provider: aws
    base_url: https://bedrock-runtime.us-east-1.amazonaws.com
    aws_access_key: xxx
    aws_secret_key: xxx
    model:
      - anthropic.claude-3-5-sonnet-20240620-v1:0: claude-3-5-sonnet

  # Cloudflare Workers AI
  - provider: cloudflare
    api: your-cf-api-key
    cf_account_id: your-account-id
    model:
      - '@cf/meta/llama-3.1-8b-instruct': llama-3.1-8b

api_keys:
  # ç®¡ç†å‘˜ Key
  - api: sk-admin-key
    role: admin
    model:
      - gpt-4o
      - claude-3-5-sonnet
      - gemini/*  # é€šé…ç¬¦ï¼šgemini æ¸ é“çš„æ‰€æœ‰æ¨¡å‹
    preferences:
      SCHEDULING_ALGORITHM: round_robin
      AUTO_RETRY: true
      rate_limit: 60/min

  # æ™®é€šç”¨æˆ· Keyï¼ˆåŠ æƒè´Ÿè½½å‡è¡¡ï¼‰
  - api: sk-user-key
    model:
      - gcp1/*: 5  # æƒé‡ 5
      - gcp2/*: 3  # æƒé‡ 3
      - gcp3/*: 2  # æƒé‡ 2
    preferences:
      SCHEDULING_ALGORITHM: weighted_round_robin
      credits: 10  # ä½™é¢é™åˆ¶
      created_at: 2024-01-01T00:00:00+08:00

# å…¨å±€é…ç½®
preferences:
  model_timeout:
    gpt-4o: 30
    claude-3-5-sonnet: 60
    default: 100
  cooldown_period: 300
  rate_limit: 999999/min
  error_triggers:
    - "The bot's usage is covered by the developer"
  model_price:
    gpt-4o: 2.5,10
    claude-3-5-sonnet: 3,15
    default: 1,2
```


### é«˜çº§å®Œæ•´é…ç½®ç¤ºä¾‹ï¼ˆä¿ç•™åŸç‰ˆå…¨éƒ¨é«˜çº§å­—æ®µï¼‰

ä¸‹é¢ç»™å‡ºä¸€ä¸ªæ›´å®Œæ•´çš„ [`api.yaml`](api.yaml:1) é«˜çº§é…ç½®ç¤ºä¾‹ï¼ŒåŒ…å«å¤šæä¾›å•†ã€å¤š API Keyã€é¢‘ç‡é™åˆ¶ã€å†·å´ã€ä»£ç†ã€ä»·æ ¼é…ç½®ç­‰ï¼ŒåŸºæœ¬è¦†ç›–åŸç‰ˆ README ä¸­çš„æ‰€æœ‰é«˜çº§å­—æ®µï¼Œä¾¿äºç›´æ¥å¯¹ç…§ä¿®æ”¹ï¼š

```yaml
providers:
  - provider: provider_name # æœåŠ¡æä¾›å•†åç§°, å¦‚ openaiã€anthropicã€geminiã€openrouterï¼Œéšä¾¿å–åå­—ï¼Œå¿…å¡«
    base_url: https://api.your.com/v1/chat/completions # åç«¯æœåŠ¡çš„APIåœ°å€ï¼Œå¿…å¡«
    api: sk-YgS6GTi0b4bEabc4C # æä¾›å•†çš„API Keyï¼Œå¿…å¡«
    model: # é€‰å¡«ï¼Œå¦‚æœä¸é…ç½® modelï¼Œä¼šè‡ªåŠ¨é€šè¿‡ base_url å’Œ api é€šè¿‡ /v1/models ç«¯ç‚¹è·å–å¯ç”¨çš„æ‰€æœ‰æ¨¡å‹ã€‚
      - gpt-4o # å¯ä»¥ä½¿ç”¨çš„æ¨¡å‹åç§°ï¼Œå¿…å¡«
      - claude-3-5-sonnet-20240620: claude-3-5-sonnet # é‡å‘½åæ¨¡å‹ï¼Œå¯ä»¥ç”¨ç®€çŸ­åˆ«å
      - dall-e-3

  - provider: anthropic
    base_url: https://api.anthropic.com/v1/messages
    api: # æ”¯æŒå¤šä¸ª API Keyï¼Œå¤šä¸ª key è‡ªåŠ¨å¼€å¯è½®è¯¢è´Ÿè½½å‡è¡¡ï¼Œè‡³å°‘ä¸€ä¸ª keyï¼Œå¿…å¡«
      - sk-ant-api03-bNnAOJyA-xQw_twAA
      - sk-ant-api02-bNnxxxx
    model:
      - claude-3-7-sonnet-20240620: claude-3-7-sonnet
      - claude-3-7-sonnet-20250219: claude-3-7-sonnet-think # å¸¦ think çš„åˆ«åä¼šè¢«è§†ä¸ºæ€è€ƒæ¨¡å‹
    tools: true # æ˜¯å¦æ”¯æŒå·¥å…·è°ƒç”¨ï¼Œé»˜è®¤ true
    preferences:
      post_body_parameter_overrides: # é’ˆå¯¹æ¨¡å‹è‡ªå®šä¹‰è¯·æ±‚ä½“å‚æ•°
        claude-3-7-sonnet-think:
          tools:
            - type: code_execution_20250522
              name: code_execution
            - type: web_search_20250305
              name: web_search
              max_uses: 5

  - provider: gemini
    base_url: https://generativelanguage.googleapis.com/v1beta # ä»…ä¾› Gemini æ¨¡å‹ä½¿ç”¨ï¼Œå¿…å¡«
    api:
      - AIzaSyAN2k6IRdgw123
      - AIzaSyAN2k6IRdgw456
      - AIzaSyAN2k6IRdgw789
    model:
      - gemini-2.5-pro
      - gemini-2.5-flash: gemini-2.5-flash # é‡å‘½ååï¼Œå¦‚æœè¿˜æƒ³ç”¨åŸåï¼Œéœ€è¦å†å†™ä¸€è¡ŒåŸå
      - gemini-2.5-flash
      - gemini-2.5-pro: gemini-2.5-pro-search # ä»¥ -search ç»“å°¾å¯ä½œä¸ºâ€œæœç´¢ç‰ˆâ€æ¨¡å‹
      - gemini-2.5-flash: gemini-2.5-flash-think-24576-search # åŒæ—¶æ”¯æŒ search ä¸ think-æ•°å­—
      - gemini-2.5-flash: gemini-2.5-flash-think-0 # think-0 è¡¨ç¤ºå…³é—­æ¨ç†
      - gemini-embedding-001
      - text-embedding-004
    tools: true
    preferences:
      api_key_rate_limit: 15/min # æ¯ä¸ª API Key æ¯åˆ†é’Ÿæœ€å¤šè¯·æ±‚æ¬¡æ•°ï¼Œæ”¯æŒ 15/min,10/day ç­‰ç»„åˆ
      # api_key_rate_limit:
      #   gemini-2.5-flash: 10/min,500/day
      #   gemini-2.5-pro: 5/min,25/day,1048576/tpr # tpr è¡¨ç¤ºæ¯æ¬¡è¯·æ±‚ tokens ä¸Šé™
      #   default: 4/min
      api_key_cooldown_period: 60 # å•ä¸ª API Key é­é‡ 429 åçš„å†·å´æ—¶é—´ï¼ˆç§’ï¼‰
      api_key_schedule_algorithm: round_robin # å¤š Key è°ƒåº¦ï¼šround_robin/random/fixed_priority/smart_round_robin
      model_timeout: # æ¨¡å‹è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œé»˜è®¤ 100 ç§’
        gemini-2.5-pro: 500
        gemini-2.5-flash: 500
        default: 10
      keepalive_interval: # å¿ƒè·³é—´éš”ï¼ˆç§’ï¼‰ï¼Œé€‚åˆ Cloudflare åœºæ™¯
        gemini-2.5-pro: 50 # å¿…é¡»å°äº model_timeout
      proxy: socks5://[ç”¨æˆ·å]:[å¯†ç ]@[IPåœ°å€]:[ç«¯å£] # æ”¯æŒ socks5 / http ä»£ç†
      headers:
        Custom-Header-1: Value-1
        Custom-Header-2: Value-2
      post_body_parameter_overrides:
        gemini-2.5-pro-search:
          tools:
            - google_search: {}
            - url_context: {}

  - provider: vertex
    project_id: gen-lang-client-xxxxxxxxxxxxxx # Google Cloud é¡¹ç›® ID
    private_key: "-----BEGIN PRIVATE KEY-----\nxxxxx\n-----END PRIVATE KEY-----" # æœåŠ¡è´¦å·ç§é’¥ JSON ä¸­çš„ private_key
    client_email: xxxxxxxxxx@xxxxxxx.gserviceaccount.com # æœåŠ¡è´¦å·é‚®ç®±
    model:
      - gemini-2.5-flash
      - gemini-2.5-pro
      - gemini-2.5-pro: gemini-2.5-pro-search
      - claude-3-5-sonnet@20240620: claude-3-5-sonnet
      - claude-3-opus@20240229: claude-3-opus
      - claude-3-sonnet@20240229: claude-3-sonnet
      - claude-3-haiku@20240307: claude-3-haiku
      - gemini-embedding-001
      - text-embedding-004
    tools: true
    notes: https://xxxxx.com/ # å¤‡æ³¨ã€å®˜æ–¹æ–‡æ¡£é“¾æ¥ç­‰
    preferences:
      post_body_parameter_overrides:
        gemini-2.5-pro-search:
          tools:
            - google_search: {}
        gemini-2.5-flash:
          generationConfig:
            thinkingConfig:
              includeThoughts: True
              thinkingBudget: 24576
            maxOutputTokens: 65535
        gemini-2.5-flash-search:
          tools:
            - google_search: {}
            - url_context: {}

  - provider: cloudflare
    api: f42b3xxxxxxxxxxq4aoGAh # Cloudflare API Key
    cf_account_id: 8ec0xxxxxxxxxxxxe721 # Cloudflare Account ID
    model:
      - '@cf/meta/llama-3.1-8b-instruct': llama-3.1-8b # å¿…é¡»ä½¿ç”¨å¼•å·
      - '@cf/meta/llama-3.1-8b-instruct'

  - provider: azure
    base_url: https://your-endpoint.openai.azure.com
    api: your-api-key
    model:
      - gpt-4o
    preferences:
      post_body_parameter_overrides:
        key1: value1
        key2: value2
        stream_options:
          include_usage: true
      cooldown_period: 0 # æ¸ é“çº§å†·å´è®¾ä¸º 0 è¡¨ç¤ºä¸å¯ç”¨å†·å´æœºåˆ¶

  - provider: databricks
    base_url: https://xxx.azuredatabricks.net
    api:
      - xxx
    model:
      - databricks-claude-sonnet-4: claude-sonnet-4
      - databricks-claude-opus-4: claude-opus-4
      - databricks-claude-3-7-sonnet: claude-3-7-sonnet

  - provider: aws
    base_url: https://bedrock-runtime.us-east-1.amazonaws.com
    aws_access_key: xxxxxxxx
    aws_secret_key: xxxxxxxx
    model:
      - anthropic.claude-3-5-sonnet-20240620-v1:0: claude-3-5-sonnet

  - provider: vertex-express
    base_url: https://aiplatform.googleapis.com/
    project_id:
      - xxx # key1 çš„ project_id
      - xxx # key2 çš„ project_id
    api:
      - xx.xxx # key1 çš„ api
      - xx.xxx # key2 çš„ api
    model:
      - gemini-2.5-pro-preview-06-05

  - provider: other-provider
    base_url: https://api.xxx.com/v1/messages
    api: sk-bNnAOJyA-xQw_twAA
    model:
      - causallm-35b-beta2ep-q6k: causallm-35b
      - anthropic/claude-3-5-sonnet
    tools: false
    engine: openrouter # å¼ºåˆ¶ä½¿ç”¨ openrouter / gpt / claude / gemini ç­‰ç‰¹å®šæ¶ˆæ¯æ ¼å¼

api_keys:
  - api: sk-KjjI60Yf0JFWxfgRmXqFWyGtWUd9GZnmi3KlvowmRWpWpQRo # API Keyï¼Œå¿…å¡«
    model: # è¯¥ Key å¯ç”¨çš„æ¨¡å‹åˆ—è¡¨ï¼Œé»˜è®¤æŒ‰æ­¤é¡ºåºè½®è¯¢
      - gpt-4o
      - claude-3-5-sonnet
      - gemini/* # ä»…ä½¿ç”¨ provider åä¸º gemini çš„æ‰€æœ‰æ¨¡å‹
    role: admin # admin Key å¯è®¿é—® /v1/stats,/v1/generate-api-key ç­‰æ•æ„Ÿæ¥å£

  - api: sk-pkhf60Yf0JGyJxgRmXqFQyTgWUd9GZnmi3KlvowmRWpWqrhy
    model:
      - anthropic/claude-3-5-sonnet # ä»… anthropic æ¸ é“ä¸‹çš„ claude-3-5-sonnet
      - <anthropic/claude-3-5-sonnet> # å°–æ‹¬å·åŒ…è£¹æ—¶ï¼Œä¸å†æ‹†åˆ† provider/nameï¼Œè€Œæ˜¯æ•´ä¸ªåŒ¹é…æ¨¡å‹å
      - openai-test/omni-moderation-latest # é“å¾·å®¡æŸ¥æ¨¡å‹
      - sk-KjjI60Yd0JFWtxxxxxxxxxxxxxxwmRWpWpQRo/* # å¯å°†å…¶ä»– API Key ä½œä¸ºâ€œæ¸ é“â€å¼•ç”¨
    preferences:
      SCHEDULING_ALGORITHM: fixed_priority # å›ºå®šä¼˜å…ˆçº§è°ƒåº¦ï¼Œå§‹ç»ˆä¼˜å…ˆç¬¬ä¸€ä¸ªå¯ç”¨æ¸ é“
      # å¯é€‰ï¼šfixed_priority / round_robin / weighted_round_robin / lottery / random / smart_round_robin
      AUTO_RETRY: true # è‡ªåŠ¨é‡è¯•ä¸‹ä¸€ä¸ªæä¾›å•†ï¼Œä¹Ÿå¯ä»¥è®¾ä¸ºæ•°å­—è¡¨ç¤ºé‡è¯•æ¬¡æ•°
      rate_limit: 15/min # é™æµæ”¯æŒå¤šç§å‘¨æœŸï¼š2/min,5/hour,10/day,10/month,10/year
      # rate_limit:
      #   gemini-2.5-flash: 10/min,500/day
      #   gemini-2.5-pro: 5/min,25/day
      #   default: 4/min
      ENABLE_MODERATION: true # æ˜¯å¦å¼€å¯æ¶ˆæ¯é“å¾·å®¡æŸ¥

  # æ¸ é“çº§åŠ æƒè´Ÿè½½å‡è¡¡ç¤ºä¾‹
  - api: sk-KjjI60Yd0JFWtxxxxxxxxxxxxxxwmRWpWpQRo
    model:
      - gcp1/*: 5 # æƒé‡ä»…æ”¯æŒæ­£æ•´æ•°ï¼Œæ•°å­—è¶Šå¤§è¢«é€‰ä¸­çš„æ¦‚ç‡è¶Šé«˜
      - gcp2/*: 3
      - gcp3/*: 2
    preferences:
      SCHEDULING_ALGORITHM: weighted_round_robin # åŸºäºæƒé‡çš„è½®è¯¢ç®—æ³•ï¼Œæˆ– lottery æŠ½å¥–å¼è°ƒåº¦
      AUTO_RETRY: true
      credits: 10 # ä½™é¢ä¸Šé™ï¼ˆç¾å…ƒï¼‰ï¼Œä¸º 0 è¡¨ç¤ºä¸å¯ä½¿ç”¨
      created_at: 2024-01-01T00:00:00+08:00 # è´¹ç”¨ç»Ÿè®¡èµ·å§‹æ—¶é—´

preferences: # å…¨å±€é…ç½®
  model_timeout: # æ¨¡å‹è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œé»˜è®¤ 100 ç§’
    gpt-4o: 10 # å¯¹ä»¥ gpt-4o å¼€å¤´çš„æ¨¡å‹éƒ½ç”Ÿæ•ˆ
    claude-3-5-sonnet: 10
    default: 10 # ä¸è®¾ç½® default æ—¶ï¼Œä¼šé€€åŒ–ä¸ºä½¿ç”¨ç¯å¢ƒå˜é‡ TIMEOUT
    o1-mini: 30
    o1-preview: 100
  cooldown_period: 300 # æ¸ é“çº§å†·å´æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œè®¾ä¸º 0 è¡¨ç¤ºä¸å¯ç”¨å†·å´æœºåˆ¶
  rate_limit: 999999/min # å…¨å±€é€Ÿç‡é™åˆ¶ï¼Œæ”¯æŒ 15/min,10/day ç­‰ç»„åˆ
  max_retry_count: 10 # å¤šæ¸ é“åœºæ™¯ä¸‹çš„æœ€å¤§é‡è¯•æ¬¡æ•°ä¸Šé™ï¼Œé»˜è®¤ 10ï¼Œè®¾ç½®èŒƒå›´ 1-100
  keepalive_interval: # å¿ƒè·³é—´éš”ï¼ˆç§’ï¼‰ï¼Œé€‚åˆé•¿æ¨ç†åœºæ™¯
    gemini-2.5-pro: 50
  log_raw_data_retention_hours: 24 # æ—¥å¿—åŸå§‹æ•°æ®ä¿ç•™æ—¶é—´ï¼ˆå°æ—¶ï¼‰ï¼Œè®¾ä¸º 0 æˆ–ä¸è®¾ç½®è¡¨ç¤ºä¸ä¿å­˜è¯·æ±‚/å“åº”åŸå§‹æ•°æ®
  error_triggers: # é”™è¯¯è§¦å‘å™¨ï¼Œå“åº”æ–‡æœ¬åŒ…å«ä»»æ„å­—ç¬¦ä¸²æ—¶è§†ä¸ºé”™è¯¯å¹¶è§¦å‘å†·å´
    - The bot's usage is covered by the developer
    - process this request due to overload or policy
  proxy: socks5://[username]:[password]@[ip]:[port] # å…¨å±€ä»£ç†åœ°å€
  model_price: # æ¨¡å‹ä»·æ ¼ï¼ˆç¾å…ƒ / ç™¾ä¸‡ tokensï¼‰ï¼Œæ ¼å¼ï¼šè¾“å…¥å•ä»·,è¾“å‡ºå•ä»·
    gpt-4o: 1,2
    claude-3-5-sonnet: 0.12,0.48
    default: 1,2
```

### è°ƒåº¦ç®—æ³•è¯´æ˜

| ç®—æ³• | è¯´æ˜ |
|------|------|
| `fixed_priority` | å›ºå®šä¼˜å…ˆçº§ï¼Œå§‹ç»ˆä½¿ç”¨ç¬¬ä¸€ä¸ªå¯ç”¨æ¸ é“ï¼ˆé»˜è®¤ï¼‰ |
| `round_robin` | è½®è¯¢è´Ÿè½½å‡è¡¡ï¼ŒæŒ‰é¡ºåºä¾æ¬¡è¯·æ±‚ |
| `weighted_round_robin` | åŠ æƒè½®è¯¢ï¼ŒæŒ‰æƒé‡é¡ºåºè¯·æ±‚ |
| `lottery` | æŠ½å¥–å¼ï¼ŒæŒ‰æƒé‡éšæœºè¯·æ±‚ |
| `random` | å®Œå…¨éšæœº |
| `smart_round_robin` | æ™ºèƒ½è°ƒåº¦ï¼ŒåŸºäºå†å²æˆåŠŸç‡æ’åº |

## ğŸ”Œ æ’ä»¶ç³»ç»Ÿ

Zoaholic æ”¯æŒé€šè¿‡æ’ä»¶æ‰©å±•åŠŸèƒ½ã€‚æ’ä»¶å¯ä»¥æ·»åŠ æ–°çš„æ¸ é“é€‚é…å™¨ã€ä¸­é—´ä»¶ã€é’©å­ç­‰ã€‚

### åˆ›å»ºæ’ä»¶

åœ¨ `plugins/` ç›®å½•ä¸‹åˆ›å»º Python æ–‡ä»¶ï¼š

```python
# plugins/my_channel.py

PLUGIN_INFO = {
    "name": "my_channel",
    "version": "1.0.0",
    "description": "æˆ‘çš„è‡ªå®šä¹‰æ¸ é“",
}

class MyChannelAdapter:
    id = "my_channel"
    type_name = "my_provider"
    
    @staticmethod
    async def request_adapter(request, engine, provider, api_key=None):
        url = provider.get('base_url')
        headers = {'Authorization': f'Bearer {api_key}'}
        payload = {...}
        return url, headers, payload
    
    @staticmethod
    async def stream_adapter(client, url, headers, payload, engine, model, timeout):
        async with client.stream('POST', url, ...) as response:
            async for line in response.aiter_lines():
                yield f"data: {line}\n\n"
        yield "data: [DONE]\n\n"

def setup(manager):
    from core.channels.registry import register_channel
    register_channel(
        id="my_channel",
        type_name="my_provider",
        request_adapter=MyChannelAdapter.request_adapter,
        stream_adapter=MyChannelAdapter.stream_adapter,
    )
```

è¯¦ç»†æ–‡æ¡£è¯·å‚é˜… [æ’ä»¶å¼€å‘æŒ‡å—](docs/plugin-development.md)ã€‚

## ğŸ–¥ï¸ ç®¡ç†å‰ç«¯

Zoaholic å†…ç½®äº†ä¸€ä¸ª Material Design 3 é£æ ¼çš„ç®¡ç†å‰ç«¯ï¼Œæä¾›ï¼š

- **æ§åˆ¶å°æ€»è§ˆ** - æŸ¥çœ‹ç³»ç»ŸçŠ¶æ€å’Œç»Ÿè®¡ä¿¡æ¯
- **èŠå¤©æµ‹è¯•** - åœ¨çº¿æµ‹è¯• API è°ƒç”¨
- **æ¸ é“ç®¡ç†** - æŸ¥çœ‹å’Œç®¡ç† API æ¸ é“
- **é…ç½®ç¼–è¾‘** - å¯è§†åŒ–ç¼–è¾‘é…ç½®æ–‡ä»¶

è®¿é—® `http://localhost:8000/` å³å¯ä½¿ç”¨å‰ç«¯ç•Œé¢ã€‚

## â“ å¸¸è§é—®é¢˜

### ä¸ºä»€ä¹ˆå‡ºç° "No matching model found" é”™è¯¯ï¼Ÿ

å°† `ENABLE_MODERATION` è®¾ç½®ä¸º `false`ã€‚å½“å¼€å¯é“å¾·å®¡æŸ¥æ—¶ï¼Œéœ€è¦é…ç½® `omni-moderation-latest` æ¨¡å‹ã€‚

### å¦‚ä½•è®¾ç½®æ¸ é“ä¼˜å…ˆçº§ï¼Ÿ

åœ¨ `api_keys` ä¸­æŒ‰é¡ºåºé…ç½®æ¨¡å‹å³å¯ï¼š

```yaml
api_keys:
  - api: sk-xxx
    model:
      - ai2/*  # ä¼˜å…ˆè¯·æ±‚
      - ai1/*  # å¤‡ç”¨
```

### å¦‚ä½•æ­£ç¡®å¡«å†™ base_urlï¼Ÿ

- OpenAI æ ¼å¼ï¼šå¿…é¡»ä»¥ `/v1/chat/completions` ç»“å°¾
- Azureï¼šæ”¯æŒ `https://your-endpoint.openai.azure.com` æˆ–å®Œæ•´ URL
- Geminiï¼šä½¿ç”¨ `https://generativelanguage.googleapis.com/v1beta`

### æ¨¡å‹è¶…æ—¶æ—¶é—´ä¼˜å…ˆçº§ï¼Ÿ

æ¸ é“çº§åˆ« > å…¨å±€é…ç½® > ç¯å¢ƒå˜é‡ `TIMEOUT`ï¼ˆé»˜è®¤ 100 ç§’ï¼‰

### ä»€ä¹ˆæ—¶å€™ API Key å…·æœ‰ç®¡ç†æƒé™ï¼Ÿ

1. åªæœ‰ä¸€ä¸ª Key æ—¶ï¼Œè‡ªåŠ¨è·å¾—ç®¡ç†æƒé™
2. å¤šä¸ª Key æ—¶ï¼Œéœ€è¦è®¾ç½® `role: admin`

## ğŸ”§ ç¯å¢ƒå˜é‡

| å˜é‡ | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `PORT` | æœåŠ¡ç«¯å£ | 8000 |
| `TIMEOUT` | é»˜è®¤è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰ | 100 |
| `DEBUG` | è°ƒè¯•æ¨¡å¼ | false |
| `RELOAD` | å¯ç”¨çƒ­é‡è½½ï¼ˆå¼€å‘æ¨¡å¼ï¼‰ | false |
| `CONFIG_URL` | è¿œç¨‹é…ç½®æ–‡ä»¶ URL | - |
| `DISABLE_DATABASE` | ç¦ç”¨æ•°æ®åº“ | false |

## ğŸ“ é¡¹ç›®ç»“æ„

```
zoaholic/
â”œâ”€â”€ main.py              # åº”ç”¨å…¥å£
â”œâ”€â”€ api.yaml             # é…ç½®æ–‡ä»¶
â”œâ”€â”€ core/                # æ ¸å¿ƒæ¨¡å—
â”‚   â”œâ”€â”€ channels/        # æ¸ é“é€‚é…å™¨
â”‚   â”œâ”€â”€ plugins/         # æ’ä»¶ç³»ç»Ÿ
â”‚   â”œâ”€â”€ handler.py       # è¯·æ±‚å¤„ç†
â”‚   â”œâ”€â”€ routing.py       # è·¯ç”±é€»è¾‘
â”‚   â””â”€â”€ ...
â”œâ”€â”€ routes/              # API è·¯ç”±
â”‚   â”œâ”€â”€ chat.py          # èŠå¤©æ¥å£
â”‚   â”œâ”€â”€ models.py        # æ¨¡å‹æ¥å£
â”‚   â””â”€â”€ ...
â”œâ”€â”€ plugins/             # ç”¨æˆ·æ’ä»¶ç›®å½•
â”œâ”€â”€ static/              # å‰ç«¯é™æ€æ–‡ä»¶
â””â”€â”€ docs/                # æ–‡æ¡£
```

## ğŸ¤ è‡´è°¢

- [uni-api](https://github.com/yym68686/uni-api) - æœ¬é¡¹ç›®çš„æŠ€æœ¯åŸºç¡€

## ğŸ“„ è®¸å¯è¯

MIT License
